---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Footer from "../../components/Footer.astro";
import DonorTable from "../../components/DonorTable.astro";
import { siteData } from "../../data/siteData";
import { getEntry } from "astro:content";

export async function getStaticPaths({ paginate }: { paginate: Function }) {
    const donorsEntry = await getEntry("donors", "donors");

    if (!donorsEntry) {
        return paginate([], { pageSize: 10 });
    }

    // Sort by amount descending
    const sortedDonors = [...donorsEntry.data].sort(
        (a, b) => b.amount - a.amount,
    );

    return paginate(sortedDonors, { pageSize: 10 });
}

const { page } = Astro.props;
---

<BaseLayout
    title="Daftar Donatur — Yayasan Pondok Pesantren Ulul Ilmi"
    description="Daftar lengkap para donatur yang telah berkontribusi."
>
    <!-- Back Navbar (same pattern as checkout) -->
    <nav class="bg-white border-b border-[#E5EBE7] sticky top-0 z-40">
        <div
            class="max-w-6xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between"
        >
            <a
                href="/"
                class="flex items-center gap-2 text-sm font-medium text-[#4A5D52] hover:text-[#0F4A2A] transition-colors duration-200"
            >
                <i class="fas fa-arrow-left"></i>
                <span class="hidden sm:inline">Kembali ke Beranda</span>
                <span class="sm:hidden">Kembali</span>
            </a>
            <a href="/" class="flex items-center gap-2">
                <img
                    src={siteData.assets.logoUrl}
                    alt={`Logo ${siteData.name}`}
                    class="h-8 w-auto"
                />
            </a>
        </div>
    </nav>

    <main class="min-h-screen bg-[var(--bg-canvas)]">
        <!-- Header Section -->
        <section
            class="bg-gradient-to-br from-[var(--primary-pine)] to-[var(--dark-moss)] py-12 md:py-16"
        >
            <div class="max-w-5xl mx-auto px-6 text-center">
                <span
                    class="inline-block bg-white/10 text-white/90 text-xs font-semibold uppercase tracking-[0.15em] px-4 py-1.5 rounded-full mb-4"
                >
                    Transparansi Donasi
                </span>
                <h1
                    class="text-3xl md:text-4xl font-bold text-white mb-3"
                    style="font-family: 'Inter', sans-serif; letter-spacing: -0.02em;"
                >
                    Daftar Donatur
                </h1>
                <p class="text-white/70 text-sm md:text-base max-w-xl mx-auto">
                    Jazākumullāhu khairan — terima kasih kepada seluruh donatur
                    atas kontribusi dan kepedulian Anda.
                </p>
            </div>
        </section>

        <!-- Table Section -->
        <section class="max-w-5xl mx-auto px-6 -mt-8 pb-16 relative z-10">
            <div class="card-luxury">
                <DonorTable page={page} />
            </div>
        </section>
    </main>

    <Footer />
</BaseLayout>
